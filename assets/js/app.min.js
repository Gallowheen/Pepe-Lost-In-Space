$(document).ready(function(){var e=document.getElementById("Canvas"),t=e.getContext("2d"),i=!1,o=!1,n=60,s=setInterval(pe,1e3/n),a=!0,l=document.getElementById("resume");l.addEventListener("click",function(){ge()}),document.getElementById("restart").addEventListener("click",function(){me()});var h=document.getElementById("mute");h.addEventListener("click",function(){console.log(ee.muted),0==ee.muted?(ee.muted=!0,te.muted=!0,oe.muted=!0,ie.muted=!0,ne.muted=!0,se.muted=!0,ae.muted=!0,h.innerHTML="Enable SFX"):(ee.muted=!1,te.muted=!1,oe.muted=!1,ie.muted=!1,ne.muted=!1,se.muted=!1,ae.muted=!1,h.innerHTML="Disable SFX")}),document.getElementById("restartOver").addEventListener("click",function(){me()});var r,d,p=document.querySelector(".twitter");r=document.getElementById("menu"),d=document.getElementById("overlay");var c=document.getElementById("over"),u=document.getElementById("score"),g=document.getElementById("record");document.getElementById("pseudo");document.getElementById("send").addEventListener("click",function(){var e=-V,t="ZZZ";""==!$("#pseudo").val()&&(t=$("#pseudo").val().toUpperCase()),e>0&&$.ajax({method:"POST",data:{score:e,pseudo:t},url:"updatescore.php"}).done(function(e){function t(e){if(null!=e){le=e.score[0].score,he=e.score[0].score;for(var t="<li class='list__header clearfix'><div>Rank</div><div>Score</div><div>Name</div></li>",i=0;i<10&&null!=e.score[i].pseudo;i++)$(".top10").html(t+="<li class='list__el clearfix'><div>"+(i+1)+"</div><div>"+e.score[i].score+"</div><div>"+e.score[i].pseudo+"</div></li>");$(".top10").html(t)}}console.log(e),$.getJSON("highscore.php",t),t()}),$(".pseudo__div").css("display","none")});var m=e.width/2-22.5,f=e.height-35,v=50,w=50,y=!1,x=1,M=3,E=!1,I=0,Y=20,X=0,k=0,S=5,P=new Image;P.src="assets/img/vaisseau2.png";var b=new Image;b.src="assets/img/nebula2.jpg";var T=new Image;T.src="assets/img/asteroide1.png";var _=new Image;_.src="assets/img/asteroide2.png";var A=new Image;A.src="assets/img/asteroide3.png";var L=new Image;L.src="assets/img/missile.png";var B=new Image;B.src="assets/img/shield.png";var D={posX:0,posY:0,length:25,height:25,velocityY:1,img:D},C=new Image;C.src="assets/img/fireRateUp.png";var H=new Image;H.src="assets/img/heal.png";var F=new Image;F.src="assets/img/healUI.png";var O=new Image;O.src="assets/img/shieldUI.png";var W,R=2,J=[],U=[],N=[],j=[],Z=e.width,q=e.height,V=0,G=0,z=0,K=4,Q=new Image;Q.src="assets/img/sprite.png";var ee=new Audio("assets/sound/explosion3.wav");ee.volume=.5,ee.muted=!0;var te=new Audio("assets/sound/launchMissile2.wav");te.volume=.15,te.duration=.15,te.muted=!0;var ie=new Audio("assets/sound/shield.wav");ie.volume=1,ie.muted=!0;var oe=new Audio("assets/sound/shielddeflect.wav");oe.muted=!0;var ne=new Audio("assets/sound/Corneria.mp3");ne.volume=.3,ne.muted=!0;var se=new Audio("assets/sound/bonus.wav");se.volume=1,se.muted=!0;var ae=new Audio("assets/sound/alert.wav");ae.volume=.05,ae.muted=!0;var le,he;!!!document.documentMode&&window.StyleMedia,!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/"),/constructor/i.test(window.HTMLElement)||(!window.safari||safari.pushNotification).toString();function re(e){if(null!=e){le=e.score[0].score,he=e.score[0].score;for(var t="<li class='list__header clearfix'><div>Rank</div><div>Score</div><div>Name</div></li>",i=0;i<10&&null!=e.score[i].pseudo;i++)$(".top10").html(t+="<li class='list__el clearfix'><div>"+(i+1)+"</div><div>"+e.score[i].score+"</div><div>"+e.score[i].pseudo+"</div></li>");$(".top10").html(t)}}function de(){t.beginPath(),t.font="30px PixelyishFont",t.fillText(-V,Z-100,90),t.fillStyle="white",t.closePath(),t.beginPath(),t.font="30px PixelyishFont",t.fillText(he,355,90),t.fillStyle="white",t.closePath(),t.beginPath(),t.font="35px PixelyishFont",t.fillText(S,90,45),t.fillStyle="white",t.textAlign="center",t.closePath(),t.beginPath(),t.font="35px PixelyishFont",t.fillText(x+"/"+M,100,q-20),t.fillStyle="red",t.textAlign="center",t.closePath(),t.beginPath(),t.font="30px PixelyishFont",t.fillText("SCORE",Z-100,45),t.fillStyle="red",t.closePath(),t.beginPath(),t.font="30px PixelyishFont",t.fillText("HIGH SCORE",355,45),t.fillStyle="white",t.closePath(),ce(O,45,q-35,50,50),ce(F,45,35,50,50)}function pe(){(z+=1)>=K&&(z=0,-V>he&&(he=-V));var n,s,h,r,d=[],p=[],c=[],u=[];if(t.clearRect(0,0,e.width,e.height),t.drawImage(b,0,-G,e.width,e.height),t.drawImage(b,0,-G-e.height,e.width,e.height),ce(P,m,f,v,w),a||I==Y&&(te.currentTime=0,te.play(),U.push({posX:m-15,posY:f-30,length:15,height:25,velocityY:10,img:L}),U.push(function(e,t){return{posX:e+25,posY:t-30,length:15,height:25,velocityY:10,img:L}}(m,f)),I=0),m+X>e.width-v/2||m+X<0+v/2||(m+=X),f+k>e.height-w/2||f+k<0+w/2||(f+=k),a||(V-=1),G-=1,!a&&J.length<R)for(var g=0;g<R-J.length;g++)J.push((n=void 0,s=void 0,h=void 0,r=void 0,void 0,n=[T,_,A],s=Math.floor(3*Math.random()+0),h=n[s],r=Math.floor(75*Math.random()+25),{posX:Math.floor(Math.random()*e.width+1),posY:Math.floor(Math.random()*e.height-e.height-50),length:r,height:r,velocityX:Math.floor(8*Math.random()-5),velocityY:Math.floor(10*Math.random()+4),rotate:Math.floor(180*Math.random()+1),rotatespeed:Math.floor(4*Math.random()+2),img:h}));if(G<-e.height&&(a||(R+=1),G=0,!a&&(W=Math.floor(100*Math.random()+1))>=0&&W<=50)){var D=Math.floor(3*Math.random()+1);1==D&&N.push({posX:Math.floor(Math.random()*e.width-70+35),posY:Math.floor(Math.random()*e.height-e.height-50),length:50,height:50,velocityY:2,img:B,type:"shield"}),2==D&&N.push({posX:Math.floor(Math.random()*e.width-70+35),posY:Math.floor(Math.random()*e.height-e.height-50),length:50,height:50,velocityY:2,img:C,type:"fireUp"}),3==D&&N.push({posX:Math.floor(Math.random()*e.width-70+35),posY:Math.floor(Math.random()*e.height-e.height-50),length:50,height:50,velocityY:2,img:H,type:"heal"})}if(!a){if(N.length>=1){$.each(N,function(t,i){N[t].posY+=N[t].velocityY,ce(N[t].img,N[t].posX,N[t].posY,N[t].length,N[t].height),ue(N[t].posX,N[t].posY,m,f)<=N[t].length/2&&(c.push(t),"shield"==N[t].type&&x<M&&(x+=1),"fireUp"==N[t].type&&Y>8&&(Y-=2,I=0),"heal"==N[t].type&&(S+=1),V-=500,se.play()),N[t].posY+N[t].height>=e.height+2*N[t].height&&c.push(t)});for(g=c.length-1;g>=0;g--)N.splice(c[g],1)}if(U.length>=1){$.each(U,function(e,t){U[e].posY-=U[e].velocityY,ce(U[e].img,U[e].posX,U[e].posY,U[e].length,U[e].height),$.each(J,function(t,i){ue(J[t].posX,J[t].posY,U[e].posX,U[e].posY)<=J[t].length/2&&(d.push(t),p.push(e),V-=100,ee.currentTime=0,ee.play(),j.push({posExplosionX:J[t].posX,posExplosionY:J[t].posY,widthExplosion:J[t].length,heightExplosion:J[t].height,offsetX:0,offsetY:0,tickActuel:0,tickSpeed:3,frame:1}))}),U[e].posY+U[e].height<=0-2*U[e].height&&p.push(e)});for(g=p.length-1;g>=0;g--)U.splice(p[g],1)}$.each(J,function(n,s){null!=J[n]&&(J[n].posX+=J[n].velocityX,J[n].posY+=J[n].velocityY,J[n].rotate+=J[n].rotatespeed,function(e,i,o,n,s,a){t.save(),t.translate(i,o),t.rotate(a*Math.PI/180),t.drawImage(e,-n/2,-s/2,n,s),t.restore()}(J[n].img,J[n].posX,J[n].posY,J[n].length,J[n].height,J[n].rotate),y||ue(J[n].posX,J[n].posY,m,f)<=J[n].length/2&&(d.push(n),E?oe.play():(ae.currentTime=0,ae.play(),P.src="assets/img/vaisseau4.png",j.push({posExplosionX:m,posExplosionY:f,widthExplosion:v,heightExplosion:w,offsetX:0,offsetY:0,tickActuel:0,tickSpeed:3,frame:1}),(S-=1)<=0&&(o=!0,ge(),i=!i,l.disabled=!0),y=!y,setTimeout(function(){y=!y,P.src="assets/img/vaisseau2.png"},3e3)),j.push({posExplosionX:J[n].posX,posExplosionY:J[n].posY,widthExplosion:J[n].length,heightExplosion:J[n].height,offsetX:0,offsetY:0,tickActuel:0,tickSpeed:3,frame:1})),J[n].posY+J[n].height>=e.height+2*J[n].height?d.push(n):J[n].posX+J[n].length>=e.width+2*J[n].length&&d.push(n))}),j.length>=1&&$.each(j,function(e,i){j[e].tickActuel+=1,j[e].tickActuel>=j[e].tickSpeed&&(j[e].offsetX+=128,j[e].tickActuel=0,j[e].frame+=1,j[e].frame%4==0&&(j[e].offsetY+=128,j[e].offsetX=0,j[e].tickActuel=0),j[e].frame>=16&&u.push(e)),t.drawImage(Q,j[e].offsetX,j[e].offsetY,128,128,j[e].posExplosionX-j[e].widthExplosion,j[e].posExplosionY-j[e].heightExplosion,2*j[e].widthExplosion,2*j[e].heightExplosion)});for(g=u.length-1;g>=0;g--)j.splice(u[g],1);for(g=d.length-1;g>=0;g--)J.splice(d[g],1);I+=1,o||de()}}function ce(e,i,o,n,s){t.drawImage(e,i-s/2,o-n/2,n,s)}function ue(e,t,i,o){return Math.sqrt(Math.pow(e-i,2)+Math.pow(t-o,2))}function ge(){a||o||("undefined"!=s&&clearInterval(s),i?(clearInterval(s),i=!1,ne.pause(),r.style.display="block"):(s=setInterval(pe,1e3/n),i=!0,ne.play(),r.style.display="none",a=!1)),o&&(clearInterval(s),i=!1,ne.pause(),c.style.display="block",u.innerHTML="Score : "+-V,0==-V&&$(".pseudo__div").css("display","none"),-V>le?(g.style.display="block",$(".menu__button--over").css("margin-top","75px"),p.addEventListener("click",function(){var e="https://twitter.com/intent/tweet?text=Je viens de finir une partie sur Pepe : Lost In Space ! J'ai réalisé le meilleur score avec "+-V+" ! Viens essayer de me battre ! https://dylanernoud.be/projets/tfa/&hashtags=Pepe,Space,DWM",t=.66*window.innerWidth,i=t*window.innerHeight/window.innerWidth;window.open(e,"newwindow","width="+t+", height="+i+", top="+(window.innerHeight-i)/2+", left="+(window.innerWidth-t)/2)})):($(".menu__button--over").css("margin-top","150px"),p.addEventListener("click",function(){var e="https://twitter.com/intent/tweet?text=Je viens de finir une partie sur Pepe : Lost In Space ! J'ai réalisé un score de "+-V+" ! Viens essayer de me battre ! https://dylanernoud.be/projets/tfa/&hashtags=Pepe,Space,DWM",t=.66*window.innerWidth,i=t*window.innerHeight/window.innerWidth;window.open(e,"newwindow","width="+t+", height="+i+", top="+(window.innerHeight-i)/2+", left="+(window.innerWidth-t)/2)})))}function me(){S=5,G=0,V=0,U=[],J=[],listeShield=[],N=[],j=[],R=3,m=e.width/2-22.5,f=e.height-35,X=0,k=0,isFiring=!1,5,x=1,M=3,E=!1,ne.currentTime=0,I=0,n=60,Y=20,setTimeout(function(){y=!1},3e3),l.disabled=!1,s=setInterval(pe,1e3/n),i=!0,ne.currentTime=0,ne.play(),r.style.display="none",c.style.display="none",g.style.display="none",$(".pseudo__div").css("display","inline-block"),o=!1}$.getJSON("highscore.php",re),re(),window.onkeydown=function(e){var t;88==(t=e.keyCode?e.keyCode:e.which)&&a&&(a=!1,d.style.display="none",ge()),a||(27==t&&ge(),69!=t||o||x>=1&&!y&&(x-=1,E=!0,y=!y,D.currentTime=0,ie.play(),P.src="assets/img/vaisseau5.png",y=!y,setTimeout(function(){y=!y,P.src="assets/img/vaisseau2.png",E=!1,y=!1},4e3)),90==t||38==t?(k=-10,38==t&&e.preventDefault()):68==t||39==t?(X=10,39==t&&e.preventDefault()):83==t||40==t?(k=10,40==t&&e.preventDefault()):81!=t&&37!=t||(X=-10,37==t&&e.preventDefault()))},window.onkeyup=function(e){var t;t=e.keyCode?e.keyCode:e.which,a||(90==t||38==t?(e.preventDefault(),k<0&&(k=0)):68==t||39==t?(e.preventDefault(),X>0&&(X=0)):83==t||40==t?(e.preventDefault(),k>0&&(k=0)):81!=t&&37!=t||(e.preventDefault(),X<0&&(X=0)))}});